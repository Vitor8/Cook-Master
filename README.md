# Welcome to the Cookmaster project repository!!

Project carried out on Trybe school. The objective was to create an API where it is possible to register and login users, where only these people will be able to access, modify and delete the recipes they have registered.

After cloning the repository, to see the application running, type the command `npm start` in your terminal.

---

## Development

To develop the project, I used the Models, Service and Controllers application layers.

Through this application, it is possible to perform the basic operations that can be done in a given database: Creation, Reading, Update and Deletion (`CRUD`).

To make any type of change in the database (such as registration, editing or deletion of recipes) it is necessary to authenticate yourself. In addition, users can be customers or administrators. Customer people can only trigger actions on the recipes he himself has created. An admin person can trigger any action on any recipe.

Authentication is done via `JWT`.

It is also possible to add an image to a recipe using the file upload provided by `multer`.

##  All my endpoints are REST standard

- I use appropriate HTTP verbs for each operation.

- Grouped and standardized URLs for each resource.

- Endpoints always return a response, whether the operations are successful or not.

## Database Connection

**⚠️ IMPORTANT! ⚠️**

When cloning the repository, install the dependencies using `npm install`.

To run the project on your machine, you must have MongoDB installed.

To make the connection with the bank, I used the following parameters:

```javascript
require('dotenv').config();
const MONGO_DB_URL = `mongodb://${process.env.HOST || 'mongodb'}:27017/Cookmaster`;
const DB_NAME = 'Cookmaster';
```

## Collections

The bank has two collections: users and revenues.

- The name of the user collection is: `users`.

The fields of the `users` collection have the format:

```json
{ "name" : "Erick Jacquin", "email" : "erickjacquin@gmail.com", "password" : "12345678", "role" : "user" }
```

The insert response returned after creating a record is as follows:

```json
{ "_id" : ObjectId("5f46914677df66035f61a355"), "name" : "Erick Jacquin", "email" : "erickjacquin@gmail.com", "password" : "12345678", "role" : "user" }
```
(The _id is automatically generated by mongodb)

- The other collection's name is: `recipes`.

The fields of the `recipes` collection have this format:

```json
{ "name" : "Receita do Jacquin", "ingredients" : "Frango", "preparation" : "10 minutos no forno" }
```

The insert response returned after creating a record is this:

```json
{ "_id" : ObjectId("5f46919477df66035f61a356"), "name" : "string", "ingredients" : "string", "preparation" : "string", "userId" : ObjectId("5f46914677df66035f61a355") }
```

---

## Linter

My code follows the pattern defined by Lint. To test run the command `npm run lint`

## Tests

Todos os requisitos do projeto são testados **automaticamente**. Cada `endpoint` possui vários requisitos e os testes para cada requisito de um `endpoint` estão no arquivo de teste correspondente.

_**Example**: The requirements related to `endpoint` `/users` are in the `users.test.js`._ file

To run the tests locally, type `npm test` in the terminal.

---

# Requirements (Endpoints)

### 1 - Endpoint for user registration

- The route is POST (`/users`).

- The request body must contain the following format. All fields are mandatory!

  ```json
  {
    "name": "string",
    "email": "string",
    "password": "string"
  }
  ```

### 2 - Endpoint for users login

- The route is POST (`/login`).

- The request body must contain the following format. All fields are mandatory!

  ```json
  {
    "email": "string",
    "password": "string"
  }
  ```

### 3 - Endpoint for recipes registration

- The route is POST (`/recipes`).

- The recipe can only be created if the user is logged in and the `JWT` token is validated.

- The request body must contain the following format. All fields are mandatory!

  ```json
  {
    "name": "string",
    "ingredients": "string",
    "preparation": "string"
  }
  ```

### 4 - Endpoint for recipes listing

- The route is GET (`/recipes`).

### 5 - Endpoint for recipe update

- The route is PUT (`/recipes/:id`).

- The recipe can only be updated if the user is logged in and the `JWT` token is validated.

- The recipe can only be updated if it belongs to the logged in user, or if that user is an admin.

- The request body must contain the following format.

  ```json
  {
    "name": "string",
    "ingredients": "string",
    "preparation": "string"
  }
  ```

### 6 - Endpoint for recipe delete

- The route is DELETE (`/recipes/:id`).

- The recipe can only be deleted if the user is logged in and the `JWT` token is validated.

- The recipe can only be deleted if it belongs to the logged-in user, or if the logged-in user is an admin.

### 7 - Endpoint to add an image to a recipe

- The route is POST (`/recipes/:id/image/`).

- O endpoint deve aceitar requisições no formato `multipart/form-data`.

- The image upload is done via `Multer` libray.

### 8 - Endpoint to read an image from a recipe

- The route is GET `/images/<id-da-receita>.jpeg`.

### 9 - Endpoint to register admin users

- The route is POST (`/users/admin`).

- It will only be possible to add an admin if this action is being done by another admin, therefore, it must be validated if there is an admin logged in.

- The request body must contain the following format.

  ```json
  {
    "name": "string",
    "email": "string",
    "password": "string"
  }
  ```
